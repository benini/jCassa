<html>
	<head>
		<link rel="stylesheet" type="text/css" href="config/colori.css">
		<link rel="stylesheet" type="text/css" href="jcassa.css">
        <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
	</head>
	<body style="background-color: black;" onmouseup="mup()">

<script>
function readQuant() {
console.log(document.getElementById("quant").value);
console.log(document.getElementById("quantita").style.display = "none");

}
</script>

<div id="quantita" style="
position:absolute;
left:0px;
top:0px;
background-color:#eeeeee;
width:300px;
height:300px;
z-index: 9002;
display:none;">
<form>
<input id="quant" type="number" name="favcolor">
</form>
<div class="metro-tile" onclick="readQuant();">
</div>
</div>

<div id="unknow-width-and-height" style="overflow: auto; position: fixed; left: 0px; top: 0px;">
    <table id="prezzi"></table>
</div>

<div id="unknow-height" style="overflow: auto; position: fixed; right: 0px; top: 0px;">
    <div id="scontr"></div>
</div>

<div id="unknow-width" style="overflow: auto; position: fixed; left: 0px; bottom: 0px;">
	<div id="reparti">
<table>
<tr>
<td>
					<div id="rep0" class="metro-tile tile-reparti"
					     style="background-image:url('config/rep1.jpg'); background-size:107px 74px;">
						</div>
</td><td>					
					<div id="rep1" class="metro-tile tile-reparti"
					     style="background-image:url('config/rep2.png'); background-size:107px 74px;">
						</div>
</td><td>				
					<div id="rep2" class="metro-tile tile-reparti"
					     style="background-image:url('config/rep3.jpg'); background-size:107px 74px;">
						</div>
</td><td>				
					<div id="rep3" class="metro-tile tile-reparti"
					     style="background-image:url('config/rep4.png'); background-size:107px 74px;">
						</div>
</td><td>				
					<div id="rep4" class="metro-tile tile-reparti"
					     style="background-image:url('config/rep5.png'); background-size:107px 74px;">
						</div>
</td><td>				
					<div id="rep5" class="metro-tile tile-reparti" 
					     style="background-image:url('config/rep6.gif'); background-size:107px 74px;">
						</div>
</td><td>				
					<div id="rep6" class="metro-tile tile-reparti" 
					     style="background-image:url('config/rep7.png'); background-size:107px 74px;">
						</div>
</td></tr></table>									

	</div>
</div>

<div style="position: fixed; right: 0px; bottom: 0px;">
	<div id="tot1" class="metro-tile tile-contanti metro-tile-blue">
		<div id="tot1_riga1">TOTALE</div>
		<div id="tot1_riga2"></div>
	</div>
</div>

		<script type="text/javascript">

function dyn_dimensions() {
var dyn_height = window.innerHeight - Math.floor(1.20 * document.getElementById("tot1").offsetHeight);
var dyn_width = window.innerWidth - Math.floor(1.10 * document.getElementById("tot1").offsetWidth);

document.getElementById("unknow-width-and-height").style.width = dyn_width;
document.getElementById("unknow-width-and-height").style.height = dyn_height;
document.getElementById("unknow-width").style.width = dyn_width;
document.getElementById("unknow-height").style.height = dyn_height;
}

window.onresize=function() { dyn_dimensions(); }
dyn_dimensions();



var audioElement = document.createElement('audio');
audioElement.setAttribute('src', 'click.ogg');
audioElement.load();

var mdown_obj;

function mdown (obj) {
    mdown_obj = obj;
    mdown_obj.className = mdown_obj.className.replace(" tile_reset", "");
    mdown_obj.className += " tile_middle";
	audioElement.play();
    return false;
}

function mup () {
    mdown_obj.className = mdown_obj.className.replace(" tile_middle", " tile_reset");
    return false;
}

function updateReparti() {
  for (var i = 0; i < reparti.length; i++) {
    var r = document.getElementById('rep' + i);
    r.className += " " + reparti[i].col;
    r.innerHTML = reparti[i].reparto;
    r.onmousedown = (function() { 
      var currI = i;
      var currR = r;
      return function () { mdown(currR); cambiaReparto(currI); return false;};
    })();
  }
}

function cambiaReparto (r) {
    var table=document.getElementById("prezzi");
    var parent = table.parentNode;
    parent.removeChild(table);
    table = document.createElement("table");
    table.id= "prezzi";
    parent.appendChild(table);

    var MAX_RIGA = 7;
    var h = 0;
    var row=table.insertRow(-1);
	var pr_array = reparti[r].prezzi;
    for (var i=0; i < pr_array.length; i++, h++) {
        if (h == MAX_RIGA) { h = 0; row=table.insertRow(-1); }
        var cell1=row.insertCell(-1);
        var divTile = document.createElement("div"); 
        divTile.className = "metro-tile tile-prezzi " + reparti[r].col;
        divTile.onmousedown = (function() { 
          var prezzo = pr_array[i].prezzo;
          var desc = pr_array[i].desc;
          var currDiv = divTile;
          var idx_reparto = r;
          var idx_prezzo = i;
          return function () { mdown(currDiv); addPrezzo(idx_reparto, idx_prezzo); return false;};
        })();
        cell1.appendChild(divTile); 
        var divDesc = document.createElement("div"); 
        divDesc.className = "desc "  + reparti[r].col; 
        divDesc.innerHTML = pr_array[i].desc;
        divTile.appendChild(divDesc); 
        var divPrezzo = document.createElement("div"); 
        divPrezzo.className = "prezzo";
		if (pr_array[i].prezzo == "") { divPrezzo.innerHTML = ""; }
        else { divPrezzo.innerHTML = "&euro; " + pr_array[i].prezzo; }
        divTile.appendChild(divPrezzo);   
    }
}

var scontrino_idx = [];
var scontrino_righe = [];

function addPrezzo (idx_reparto, idx_prezzo) {
    var div_scontr = document.getElementById("scontr");
    var prezzo = reparti[idx_reparto].prezzi[idx_prezzo].prezzo;
    var desc = reparti[idx_reparto].prezzi[idx_prezzo].desc;

    if (scontrino_idx.length == 0) {
        scontrino_righe.length = 0;
        while (div_scontr.hasChildNodes()) {
            div_scontr.removeChild(div_scontr.lastChild);
        }
    }

    var divTile;
    var idx = scontrino_idx.indexOf("r" + idx_reparto + "p" + idx_prezzo);
    if (idx == -1) {
        idx = scontrino_idx.push("r" + idx_reparto + "p" + idx_prezzo) -1;
        scontrino_righe.push({quant: 1, desc: desc, prezzo: prezzo});

    	divTile = document.createElement("div"); 
    	divTile.className = "metro-tile tile-scontrino " + reparti[idx_reparto].col;
	    divTile.onmousedown = (function() { 
    	    var currDiv = divTile;
    	    return function () { mdown(currDiv); changeScontrino(currDiv); return false;};
    	})();
        document.getElementById("scontr").appendChild(divTile);
    } else {
        divTile = document.getElementById("scontr").childNodes[idx];
        scontrino_righe[idx].quant += 1;
    }

  	divTile.innerHTML = desc + "<br>" + "N. " + scontrino_righe[idx].quant + "  x  &euro; " + prezzo;
	ScontrinoSelectTile(divTile);
    updateTotale();
}

function ScontrinoSelectTile(divTile) {
    var scontr_last_sel = document.getElementById("scontr_selected");
    if (scontr_last_sel) {
        scontr_last_sel.className = scontr_last_sel.className.replace(" tile-scontrino-selected", "");
        scontr_last_sel.id = "";
    }
    divTile.className += " tile-scontrino-selected";
    divTile.id = "scontr_selected";
    divTile.scrollIntoView();
}

function updateTotale() {
    var tot = document.getElementById("tot1");
    tot.onmousedown = (function() { 
          var currDiv = tot;
          return function () { mdown(currDiv); chiudiScontrino(); return false;};
        })();    
    document.getElementById("tot1_riga1").innerHTML = "SubTotale"; 

    var scontrino_totale = 0;
    for (var i=0; i < scontrino_righe.length; ++i) {
		scontrino_totale += scontrino_righe[i].quant * scontrino_righe[i].prezzo.replace(",",".");
    }
    document.getElementById("tot1_riga2").innerHTML = "&euro; " + scontrino_totale.toFixed(2);
}

function changeScontrino(divTile) {
    ScontrinoSelectTile(divTile);
    document.getElementById("quantita").style.display = "block";
}

function chiudiScontrino() {
    scontrino_idx.length = 0;

    var tot = document.getElementById("tot1");    
    tot.onmousedown = (function() { 
          var currDiv = tot;
          return function () { mdown(currDiv); inviaScontrino(); return false;};
        })();
    document.getElementById("tot1_riga1").innerHTML = ""; 
    var tot = document.getElementById("tot1_riga2");
    tot.innerHTML = "STAMPA";
}

function inviaScontrino() {
// Invia alla cassa

    var tot = document.getElementById("tot1");
    tot.onmousedown = function () { return false; }
    document.getElementById("tot1_riga1").innerHTML = "";
    var tot = document.getElementById("tot1_riga2");    
    tot.innerHTML = "";
}





var reparti = [];
reparti.push({reparto: "BAR", col: "brown", prezzi: [] });
reparti.push({reparto: "BAR", col: "metro-tile-green", prezzi: [] });
reparti.push({reparto: "PANINI", col: "metro-tile-blue", prezzi: [
{desc: "CAFFE", prezzo: "1,10"},
{desc: "COCA", prezzo: "2,00"}
] });
reparti.push({reparto: "BAR", col: "metro-tile-purple", prezzi: [] });
reparti.push({reparto: "VINI", col: "colore_rep5", prezzi: [] });
reparti.push({reparto: "BIRRE", col: "colore_rep6", prezzi: [] });
reparti.push({reparto: "BAR", col: "metro-tile-orange", prezzi: [] });
 var prezzi = ["BAR", "PRIMI", "PIZZE", "A", "b", "11,40", "7", "BAR", "PRIMI"];

reparti[0].prezzi.push({desc: "BAR", prezzo: ""});
reparti[0].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[1].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[1].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[1].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[1].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[1].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[1].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[1].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[1].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[1].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[1].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[1].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[2].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[2].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[2].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[2].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[2].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[3].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[3].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[3].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[3].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[3].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[3].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[3].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[4].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[4].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[4].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[4].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[4].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[4].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[5].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[5].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[5].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[5].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[5].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[5].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});
reparti[6].prezzi.push({desc: "CAFFE", prezzo: "1,10"});
reparti[6].prezzi.push({desc: "COCA", prezzo: "2,00"});
reparti[6].prezzi.push({desc: "Cappuccino", prezzo: "2,00"});
reparti[6].prezzi.push({desc: "Descrizione mooooooooooolto lunga", prezzo: "2,00"});
reparti[6].prezzi.push({desc: "TEA", prezzo: "1,80"});
reparti[6].prezzi.push({desc: "MENU PRANZO", prezzo: "11,90"});



function loadPrezzi() {
// Leggi da file onload
  updateReparti();
}

loadPrezzi();



		</script>
	</body>
</html>
