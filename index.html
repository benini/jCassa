<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">

	<link rel="stylesheet" type="text/css" href="config/colori.css">
	<link rel="stylesheet" type="text/css" href="jcassa.css">

	<script type='application/javascript' src='fastclick.js'></script>

</head>
<body style="background-color: black;">

<audio id="click_snd" src="img/click.wav"></audio>

<div id="unknow-width-and-height" style="overflow: auto; position: fixed; left: 0px; top: 0px;">
    <div id="prezzi" style="width:100%"></div>
</div>

<div id="unknow-height" style="overflow: auto; position: fixed; right: 0px; top: 0px;">
    <div id="scontr"></div>
</div>

<div id="unknow-width" style="overflow: auto; position: fixed; left: 0px; bottom: 0px;">
	<table><tr id="reparti"></tr></table>
</div>

<div style="position: fixed; right: 0px; bottom: 3px;">
	<div id="tot1" class="metro-tile tile-totale tile-totale-menu">
		<div id="tot1_riga1"></div>
		<div id="tot1_riga2"></div>
	</div>
</div>

<div id="modalInput" class="modalInput">

    <div id="modalInput Menu" class="modalInput">
	    <div class="modalInputBackground"></div>
        
        <div style="float:right; margin-right: 10px;">
            <div id="menu_annulla" class="pulsante pulsante_annulla"></div>
        </div>

        <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">CHIUSURA FISCALE</div>
        </div>
        <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">GIORNALE<br>DI FONDO</div>
        </div>
        <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">RISTAMPA ULTIMO SCONTR.</div>
        </div>
        <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">RICHIAMA PRECONTO</div>
        </div>
        <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">PROGRAM. PRODOTTI</div>
        </div>
        <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">STAMPA ELENCO PRODOTTI</div>
        </div>

        
		<div style="clear:both; width: 80%; background-color: black; border: solid 2px white; text-align:center; color: white; font-size: 24px; margin: 0 auto;">
			<p>Versione DEMO</p>
			<p>X Info:<br>
				Office Line snc<br>
				<a href="mailto:officelinefaenza@gmail.com?Subject=Demo jCassa">officelinefaenza@gmail.com</a><br>
				Tel. 0546.28348
			</p>
        </div>
    </div>

    <div id="modalInputTotale" class="modalInput">
        <div class="modalInputBackground"></div>
        
        <div style="float:right; margin-right: 10px;">
            <div id="totale_annulla" class="pulsante pulsante_annulla"></div>
            <div id="totale_elimina" class="pulsante pulsante_elimina" style="margin-top: 8px; margin-bottom: 10px;"></div>
        </div>
        
        <div class="pulsante pulsante_menu" style="border-color: yellow">CONTANTI</div>
        <div class="pulsante pulsante_menu">BANCOMAT</div>
        <div class="pulsante pulsante_menu">PRECONTO</div>
        <div class="pulsante pulsante_menu">FATTURA</div>
	    <div class="pulsante pulsante_menu">
            <div class="pulsante_menu_2righe">SCONTRINO PARLANTE</div>
        </div>
        <div class="pulsante pulsante_menu">BUONI PASTO</div>

		<div style="clear:both; width: 80%; background-color: black; border: solid 2px white; text-align:center; color: white; font-size: 24px; margin: 0 auto;">
			<p>Versione DEMO</p>
			<p>X Info:<br>
				Office Line snc<br>
				<a href="mailto:officelinefaenza@gmail.com?Subject=Demo jCassa">officelinefaenza@gmail.com</a><br>
				Tel. 0546.28348
			</p>
        </div>
    </div>

    <div id="modalInputProdotto" class="modalInput">
	    <div class="modalInputBackground"></div>

	    <div style="float:right; margin-right: 10px;">
		    <div id="prodotto_annulla" class="pulsante pulsante_annulla"></div>
		    <div id="prodotto_elimina" class="pulsante pulsante_elimina" style="margin-top: 40px"></div>
		    <div id="prodotto_ok" class="pulsante pulsante_ok" style="margin-top: 40px"></div>
	    </div>

        <div style="float:right; margin-top: 8px; margin-right: 50px;">
            <div id="prodotto_prezzo" class="keypad_tile keypad_animazione keypad_colore-prezzo" style="margin-bottom: 40px;">
                <div class="keypad_tile-header">PREZZO UNITARIO</div>
                <div id="prodotto_digit_prezzo" class="keypad_tile-digits"></div>
            </div>

            <div id="prodotto_quantita" class="keypad_tile keypad_animazione keypad_colore-quantita">
                <div class="keypad_tile-header">QUANTITA'</div>
                <div id="prodotto_digit_quantita" class="keypad_tile-digits"></div>
            </div>

    	    <table id="prodotto_keypad" class="keypad keypad_quantita">
		        <tr><td>1</td><td>2</td><td>3</td></tr>
		        <tr><td>4</td><td>5</td><td>6</td></tr>
    		    <tr><td>7</td><td>8</td><td>9</td></tr>
	    	    <tr><td>0</td><td id="prodotto_keypad_special">00</td><td style="color: red;">C</td></tr>
	        </table>
        </div>
    </div>

    <div id="modalInputResto" class="modalInput">
	    <div class="modalInputBackground"></div>

        <div style="float:right; margin-right: 10px;">
    	    <div id="resto_annulla" class="pulsante pulsante_annulla"></div>
		    <div id="resto_ok" class="pulsante pulsante_ok" style="margin-top: 128px"></div>
	    </div>

        <div style="float:right; margin-top: 8px; margin-right: 50px;">
            <div class="keypad_tile tile-totale-subtotale">
                <div class="keypad_tile-header">RESTO</div>
                <div id="resto_calcolato" class="keypad_tile-digits"></div>
            </div>
            <div class="keypad_tile keypad_colore-prezzo" style="height: 34px; margin-top: 10px;">
                <div id="resto_digitato" class="keypad_tile-digits"></div>
            </div>
    	    <table id="resto_keypad" class="keypad">
		        <tr><td>1</td><td>2</td><td>3</td></tr>
		        <tr><td>4</td><td>5</td><td>6</td></tr>
		        <tr><td>7</td><td>8</td><td>9</td></tr>
		        <tr><td>0</td><td>00</td><td style="color: red;">C</td></tr>
	        </table>
        </div>
    </div>

</div>


<script type="text/javascript">


/* *****************************************
// MODAL_INPUT: Diverse finestre di input:
- " Menu":
    	attivata cliccando su totale senza scontrini aperti, cioè dopo aver stampato (o annullato) uno scontrino
		permette di fare le letture/chiusure di cassa e le stampe del dgfe
- "Prodotto":
		attivata cliccando su tile-scontrino
		permette di cambiare la quantità ed il prezzo del prodotto nello scontrino
- "Totale":
		attivata cliccando su subtotale (scontrino aperto)
		permette di cambiare il totale di  Menu, fare fatture e scontrini parlanti e pagamenti con i buoni pasto
- "Resto":
		attivata cliccando su tile-scontrino-resto
		permette di inserire l'importo esatto su cui calcolare il resto; se attivata prima di stampare lo scontrino l'importo verrà scritto sullo scontrino  stesso
*******************************************/
function modalInput(tipo, tile) {
	if (tipo == "Resto") {
        modalInputResto();
	} else if (tipo == "Prodotto") {
        modalInputProdotto(tile, "quantita");
	} else if (tipo == "ProdottoPrezzo") {
        tipo = "Prodotto";
        modalInputProdotto(tile, "prezzo");
	} else if (tipo == " Menu") {
        modalInputMenu();
	} else if (tipo == "Totale") {
        modalInputTotale();
	}

	document.getElementById("modalInput Menu").style.display = "none";
    document.getElementById("modalInputProdotto").style.display = "none";
    document.getElementById("modalInputTotale").style.display = "none";
	document.getElementById("modalInputResto").style.display = "none";

    if (tipo == "") {
        document.getElementById("modalInput").style.display = "none";
        return;
	} else {
    	document.getElementById("modalInput" + tipo).style.display = "block";
	    document.getElementById("modalInput").style.display = "block";
	}
}

function modalInputMenu () {
    document.getElementById("menu_annulla").onclick = uiEventAnnulla;
    
    function uiEventAnnulla() {
        animaClick(this);
        modalInput("");
    }
}

function modalInputTotale () {
    document.getElementById("totale_annulla").onclick = uiEventAnnulla;
    document.getElementById("totale_elimina").onclick = uiEventElimina;
    
    function uiEventAnnulla() {
        animaClick(this);
        heloperRiapriScontrino();
        modalInput("");
    }

    function uiEventElimina() {
        animaClick(this);
        var div_scontr = document.getElementById("scontr");
        for (var i = div_scontr.childNodes.length; i > 0; i--) {
            div_scontr.removeChild(div_scontr.firstChild);
        }
        updateTotale();
        modalInput("");
    }
}

function modalInputProdotto (tile, keypad_iniziale) {
    var tiles = document.getElementById("scontr").childNodes;
    for (var idx = 0; idx < tiles.length && tiles[idx] != tile; ++idx) {}
    if (idx == tiles.length) { console.log("Errore in modalInputProdotto"); return; }

    var digits = "";
    var prodotto_visore = "";
    keypadReset(keypad_iniziale);
    if (keypad_iniziale == "prezzo") {
        document.getElementById("prodotto_prezzo").style.setProperty("-webkit-animation-name", "move_down_fast");
    	document.getElementById("prodotto_quantita").style.setProperty("-webkit-animation-name", "move_up_fast");
    } else {
	    document.getElementById("prodotto_quantita").style.setProperty("-webkit-animation-name", "");
        document.getElementById("prodotto_prezzo").style.setProperty("-webkit-animation-name", "");
    }

    document.getElementById("prodotto_annulla").onclick = uiEventAnnulla;
    document.getElementById("prodotto_elimina").onclick = uiEventElimina;
    document.getElementById("prodotto_ok").onclick = uiEventOK;
    document.getElementById("prodotto_prezzo").onclick = uiEventCambiaPrezzo;
    document.getElementById("prodotto_quantita").onclick = uiEventCambiaQuantita;
    var tasti = document.getElementById("prodotto_keypad").getElementsByTagName("TD");
    for (var i = 0; i < tasti.length; i++) { tasti[i].onclick = uiEventKeypad; }

    document.getElementById("prodotto_digit_prezzo").innerHTML = "&euro; " + scontrino.getPrezzo(idx);
    document.getElementById("prodotto_digit_quantita").innerHTML = scontrino.getQuantita(idx);

    function uiEventAnnulla() {
        animaClick(this);
        modalInput("");
    }

    function uiEventOK() {
        animaClick(this);
        updateTileProdotto(tile, document.getElementById("prodotto_digit_quantita").innerHTML, document.getElementById("prodotto_digit_prezzo").innerHTML);
        modalInput("");
    }

    function uiEventElimina() {
        animaClick(this);
        scontrino.elimina(idx);
        document.getElementById("scontr").removeChild(tile);
        updateTotale();
        modalInput("");
    }

    function uiEventKeypad () {
        var tasto = this.innerHTML;
        if (tasto == "," && digits.indexOf(",") != -1) { return; }

        var tasto = this.innerHTML;
        if (tasto == "C") {
            digits = "";
	    } else {
            if (digits.length > 8) { return; }
	        digits += tasto;
	    }
        animaClick(this);

        if (prodotto_visore == "prezzo") {
            var a = String((digits / 100).toFixed(2));
    	    document.getElementById("prodotto_digit_prezzo").innerHTML = "&euro; " + a.replace(".", ",");
        } else {
    		document.getElementById("prodotto_digit_quantita").innerHTML = digits;
        }
    }

    function keypadReset(tipo) {
        digits = "";
        if (prodotto_visore == tipo) { console.log("Non dovrei essere qui"); }
        prodotto_visore = tipo;
        if (tipo == "prezzo") {
            document.getElementById("prodotto_keypad_special").innerHTML = "00";
            var keypad = document.getElementById("prodotto_keypad");
            keypad.className = keypad.className.replace(" keypad_quantita", "");
        } else {
            document.getElementById("prodotto_keypad_special").innerHTML = ",";
            var keypad = document.getElementById("prodotto_keypad");
            keypad.className = keypad.className.replace(" keypad_quantita", "");
            keypad.className += " keypad_quantita";
        }
    }

    function uiEventCambiaPrezzo() {
        animaClick(this);
        keypadReset("prezzo");
		document.getElementById("prodotto_prezzo").style.setProperty("-webkit-animation-name", "move_down");
		document.getElementById("prodotto_quantita").style.setProperty("-webkit-animation-name", "move_up");
	}

    function uiEventCambiaQuantita() {
        animaClick(this);
        keypadReset("quantita");
	    document.getElementById("prodotto_prezzo").style.setProperty("-webkit-animation-name", "move_down_reverse");
	    document.getElementById("prodotto_quantita").style.setProperty("-webkit-animation-name", "move_up_reverse");
    }
}


function modalInputResto () {
    var digits = "";
    var prev_modal = "";
    if (document.getElementById("modalInputTotale").style.display == "block") { prev_modal = "Totale"; }
    document.getElementById("resto_annulla").onclick = uiEventAnnulla;
    document.getElementById("resto_ok").onclick = uiEventAnnulla;
    var tasti = document.getElementById("resto_keypad").getElementsByTagName("TD");
    for (var i = 0; i < tasti.length; i++) { tasti[i].onclick = uiEventKeypad; }
    updateResto();

    function uiEventAnnulla() {
        animaClick(this);
        modalInput(prev_modal);
    }

    function uiEventKeypad () {
        animaClick(this);
	    var tasto = this.innerHTML;
	    if (tasto == "C") {
            digits = "";
	    } else {
            if (digits.length > 8) { return; }
	        digits += tasto;
	    }
        updateResto();
    }
    function updateResto() {
	    var a = String((digits / 100).toFixed(2));
	    document.getElementById("resto_digitato").innerHTML = "&euro; " + a.replace(".", ",");

	    var b = scontrino.getResto(a)[1];
	    document.getElementById("resto_calcolato").innerHTML = "&euro; " + b.replace(".", ",");
    }
}

	window.addEventListener('load', function() {
        new FastClick(document.body); // Caricamento FastClick per iPad
        dyn_dimensions();
        window.onresize=function() { dyn_dimensions(); }

        loadProdotti();

    }, false);

	// Calcolo della dimensione della sezione "prezzi" in base alla spazio disponbile
	function dyn_dimensions() {
        // L'idea originale era di creare due classi unknown-width e unknown-height e assegnarle
        // agli oggetti che ne avevano bisogno, ma è più complicato di quanto pensassi senza jQuery
        // e per adesso voglio scrivere puro Javascript per imparare i dettagli
		var dyn_height = window.innerHeight - Math.floor(1.20 * document.getElementById("tot1").offsetHeight);
		var dyn_width = window.innerWidth - Math.floor(1.05 * document.getElementById("tot1").offsetWidth);

		document.getElementById("unknow-width-and-height").style.width = dyn_width;
		document.getElementById("unknow-width-and-height").style.height = dyn_height;
		document.getElementById("unknow-width").style.width = dyn_width;
		document.getElementById("unknow-height").style.height = dyn_height;

        document.getElementById("modalInput").style.width = dyn_width;
        document.getElementById("modalInput").style.height = window.innerHeight;
	}

    function loadProdotti() {
        // Chiedere i prodotti con un xml asyncrono?
        updateReparti();
    }

    function updateReparti() {
        for (var i = 0; i < reparti.length; i++) {
            var divTile = document.createElement("div");
            divTile.className = "metro-tile tile-reparti " + reparti[i].col;
            divTile.innerHTML = reparti[i].reparto;
            divTile.onclick = uiEventCambiaReparto(i);
            document.getElementById('reparti').insertCell(-1).appendChild(divTile);
        }
    }

	function animaClick(tile) {
		tile.className = tile.className.replace(" tile_reset", "");
		tile.className += " tile_middle";
		setTimeout(function() {tile.className = tile.className.replace(" tile_middle", " tile_reset");}, 100);
		var click = document.getElementById("click_snd")
        try { // Sull'Ipad currentTime a volte non funziona (quando il suono è già finito?)
            click.pause();
		    click.currentTime = 0;
        } catch (e) {}

		click.play();
	}

	function animaSelezionaRigaScontrino(divTile) {
		var scontr_last_sel = document.getElementById("scontr_selected");
		if (scontr_last_sel) {
			scontr_last_sel.className = scontr_last_sel.className.replace(" tile-scontrino-selected", "");
			scontr_last_sel.id = "";
		}

		if (divTile) {
			divTile.className += " tile-scontrino-selected";
			divTile.id = "scontr_selected";
			divTile.scrollIntoView();
		}
	}


	function uiEventCambiaReparto (r) {
		return function () {
			animaClick(this);
		    var div_prodotti=document.getElementById("prezzi");
		    while (div_prodotti.hasChildNodes()) { div_prodotti.removeChild(div_prodotti.lastChild); }

			var pr_array = reparti[r].prezzi;
			for (var i=0; i < pr_array.length; i++) {
				var divTile = document.createElement("div");
				divTile.className = "metro-tile " + reparti[r].col + " tile-prezzi";
				divTile.onclick = uiEventAggiungiProdotto(r, i);
				div_prodotti.appendChild(divTile);
				var divDesc = document.createElement("div");
				divDesc.className = "desc "  + reparti[r].col;
				divDesc.innerHTML = pr_array[i].desc;
				divTile.appendChild(divDesc);
				var divPrezzo = document.createElement("div");
				divPrezzo.className = "prezzo";
				if (pr_array[i].prezzo == "") { divPrezzo.innerHTML = ""; }
				else { divPrezzo.innerHTML = "&euro; " + pr_array[i].prezzo; }
				divTile.appendChild(divPrezzo);
			}
		}
	}

	function uiEventAggiungiProdotto(idx_reparto, idx_prezzo) {
		return function () {
			animaClick(this);
			if (! scontrino.isAperto()) {
				var div_scontr = document.getElementById("scontr");
				while (div_scontr.hasChildNodes()) { div_scontr.removeChild(div_scontr.lastChild);	}

                var tot = document.getElementById("tot1");
                tot.className = tot.className.replace(" tile-totale-menu", " tile-totale-subtotale");
			}

			var prezzo = reparti[idx_reparto].prezzi[idx_prezzo].prezzo;
            var desc = reparti[idx_reparto].prezzi[idx_prezzo].desc;
            var idx = scontrino.push(idx_reparto, 1, desc, prezzo);
            var divTile = document.createElement("div");
            divTile.className = "metro-tile tile-scontrino " + reparti[idx_reparto].col;
			divTile.onclick = uiEventCambiaRigaScontrino;
			document.getElementById("scontr").appendChild(divTile);
            if (prezzo.length < 1) {
                modalInput("ProdottoPrezzo", divTile);
            } else {
                var idx_duplicato = scontrino.unisciDuplicato(idx);
                if (idx_duplicato != -1) {
                    document.getElementById("scontr").removeChild(divTile);
                    divTile = document.getElementById("scontr").childNodes[idx_duplicato];
                }
            }
            updateTileProdotto(divTile);
		}
	}

    // Prezzo e quantità
    function updateTileProdotto(tile, quant, prezzo, desc) {
        var idx = 0;
        var tiles = document.getElementById("scontr").childNodes;
        for (; idx < tiles.length && tiles[idx] != tile; ++idx) {}
        if (idx == tiles.length) { console.log("Errore in updateTileProdotto"); return; }

        scontrino.set(idx, quant, prezzo, desc);
/* Questo codice eliminerebbe i duplicati anche se viene cambiato il prezzo in uno uguale;
// è una finezza, ma mi sembra fuorviante in qualche modo;
// perciò i duplicati vengono eliminati solo in uiEventAggiungiProdotto

        var idx_duplicato = scontrino.unisciDuplicato(idx);
        if (idx_duplicato != -1) {
            document.getElementById("scontr").removeChild(tile);
            tile = tiles[idx_duplicato];
            idx = idx_duplicato;
        }*/

        tile.innerHTML = scontrino.getDesc(idx) + "<br>" + "N. " + scontrino.getQuantita(idx) + "  x  &euro; " + scontrino.getPrezzo(idx);

        animaSelezionaRigaScontrino(tile);

        updateTotale();
    }

	function updateTotale() {
        var tot = document.getElementById("tot1");
        if (scontrino.isAperto()) {
            if (document.getElementById("scontr").childNodes.length > 0) {
                tot.onclick = uiEventChiudiScontrino;
                document.getElementById("tot1_riga1").innerHTML = "SubTotale";
                document.getElementById("tot1_riga2").innerHTML = "&euro; " + scontrino.getTotale();
                return;
            } else {
                scontrino.chiudi();                
            }
        }
        
        tot.onclick = uiEventLetture;
        tot.className = tot.className.replace(" tile-totale-subtotale", " tile-totale-menu");
        tot.className = tot.className.replace(" tile-totale-stampa", " tile-totale-menu");
    	document.getElementById("tot1_riga1").innerHTML = "";
		document.getElementById("tot1_riga2").innerHTML = "";        
	}

	function uiEventCambiaRigaScontrino() {
		animaClick(this);
		if (! scontrino.isAperto()) {
			heloperRiapriScontrino();
		}
		animaSelezionaRigaScontrino(this);
		modalInput("Prodotto", this);
	}

	function uiEventRiapriScontrino() {
		animaClick(this);
		heloperRiapriScontrino();
	}

	function heloperRiapriScontrino() {
		scontrino.Riapri();
		var div_scontr = document.getElementById("scontr");
		if (div_scontr.lastChild) { div_scontr.removeChild(div_scontr.lastChild); }
		if (div_scontr.lastChild) { div_scontr.removeChild(div_scontr.lastChild); }

		var tot = document.getElementById("tot1");
		tot.className = tot.className.replace(" tile-totale-stampa", " tile-totale-subtotale");
		updateTotale();
		modalInput("");
	}


	function uiEventChiudiScontrino () {
        if (document.getElementById("modalInputProdotto").style.display == "block") {
            //TODO: Sarebbe meglio chiamare la conferma della finestra modale?
            return;
        }

		animaClick(this);
        var tot = document.getElementById("tot1");
		tot.onclick = uiEventInviaScontrino;
        tot.className = tot.className.replace(" tile-totale-subtotale", " tile-totale-stampa");
		document.getElementById("tot1_riga1").innerHTML = "";
		document.getElementById("tot1_riga2").innerHTML = "STAMPA";

		scontrino.chiudi();

		animaSelezionaRigaScontrino();

        var divTile = document.createElement("div");
        divTile.className = "metro-tile tile-scontrino-totale";
		divTile.onclick = uiEventRiapriScontrino;
		document.getElementById("scontr").appendChild(divTile);
        divTile.innerHTML = "<div style='font-size:18px; margin-bottom: 10px; text-align:center;'>CONTANTI</div>";
        divTile.innerHTML += "TOTALE<br> &euro; " + scontrino.getTotale();

        var divTile = document.createElement("div");
        divTile.className = "metro-tile tile-scontrino-resto";
		divTile.onclick = function () { animaClick(this); modalInput("Resto"); };
		document.getElementById("scontr").appendChild(divTile);
        divTile.innerHTML = "<div style='font-size:18px; margin-bottom: 10px; text-align:center;'>RESTO</div>";
		var i = 0;
		var resti = scontrino.getResto();
		while (i < resti.length) {
            divTile.innerHTML += "<div style='float:left; width: 44%;'> &euro; " + resti[i++] +
            "</div><div style='float:left; width: 20%;'>==></div> &euro; " + resti[i++] + "<br>";
		}
		divTile.scrollIntoView();

        modalInput("Totale");
    }

	function uiEventInviaScontrino() {
		animaClick(this);
        updateTotale();
		modalInput("");
        var div_scontr = document.getElementById("scontr");
        for (var i = div_scontr.childNodes.length; i > 2; i--) {
            div_scontr.removeChild(div_scontr.firstChild);
        }
		div_scontr.firstChild.onclick = "";
        div_scontr.firstChild.innerHTML = "<div style='font-size:18px; margin-bottom: 10px; text-align:center;'>ULTIMA VENDITA</div>";
        div_scontr.firstChild.innerHTML += "TOTALE<br> &euro; " + scontrino.getTotale();
        scontrino.invia();
	}

	function uiEventLetture() {
		animaClick(this);
		modalInput(" Menu");
	}

	var scontrino = {};
	scontrino.id = [];
	scontrino.righe = [];
	scontrino.creaID = function (rep, desc, prezzo) {
        return "r" + rep + "d" + desc + "p" + prezzo;
        }

	scontrino.push = function (rep, quant, desc, prezzo) {
		if (scontrino.id.length != scontrino.righe.length) { scontrino.righe.length = scontrino.id.length; }
        quant = Number(String(quant).replace(",","."));
        prezzo = Number(String(prezzo).replace(",","."));
		scontrino.righe.push({rep: rep, quant: quant, desc: desc, prezzo: prezzo});
		return scontrino.id.push(scontrino.creaID(rep, desc, prezzo)) -1;
	}

    scontrino.elimina = function (idx) {
        scontrino.id.splice(idx, 1);
        scontrino.righe.splice(idx, 1);
    }

    scontrino.set = function (idx, quant, prezzo, desc) {
        if (desc && desc != "") { scontrino.righe[idx].desc = desc; }
        if (quant && quant != "") { scontrino.righe[idx].quant = Number(String(quant).replace(",",".")); }
        if (prezzo && prezzo != "") {
            scontrino.righe[idx].prezzo = Number(String(prezzo).replace(",",".").replace("\u20ac ", "") );
        }
        var riga = scontrino.righe[idx];
        scontrino.id[idx] = scontrino.creaID(riga.rep, riga.desc, riga.prezzo);
    }

    scontrino.getPrezzo = function (idx) {
        return scontrino.righe[idx].prezzo.toFixed(2).replace(".", ",");
    }

    scontrino.getQuantita = function (idx) {
        return String(scontrino.righe[idx].quant).replace(".", ",");
    }

    scontrino.getDesc = function (idx) {
        return scontrino.righe[idx].desc;
    }

	scontrino.getTotale = function () {
		var scontrino_totale = 0;
		for (var i=0; i < scontrino.righe.length; ++i) {
			scontrino_totale += scontrino.righe[i].quant * scontrino.righe[i].prezzo;
		}
		return scontrino_totale.toFixed(2).replace(".", ",");
	}
	scontrino.chiudi = function () {
        scontrino.id.length = 0;
    }
	scontrino.getResto = function (resto) {
		var res = [];
		var tot = scontrino.getTotale().replace(",", ".");

		if (resto) {
			var a = Number(resto.replace(",", ".")) - tot;
			if (a < 0) { a = 0; }
			res.push(resto);
			res.push(a.toFixed(2).replace(".", ","));
		} else {
			var tagli = [1, 5, 10, 50];
			for (var i = 0; i < tagli.length; i++) {
				var a = Math.ceil(tot / tagli[i]) * tagli[i];
				var b = a - tot;
				if (b != 0 && res.indexOf(a) == -1) { res.push(a); res.push(b); }
			}

			for (var i = 0; i < res.length; i++) {
				res[i] = res[i].toFixed(2).replace(".", ",");
			}
		}

		return res;
	}
	scontrino.Riapri = function () {
		scontrino.id.length = 0;
		for (var i=0; i<scontrino.righe.length; ++i) {
			var riga = scontrino.righe[i];
			scontrino.id.push(scontrino.creaID(riga.rep, riga.desc, riga.prezzo));
		}
	}
	scontrino.isAperto = function () {
        return scontrino.id.length != 0;
	}
	scontrino.indexOf = function (rep, desc, prezzo) {
        prezzo = Number(String(prezzo).replace(",","."));
		var id = scontrino.creaID(rep, desc, prezzo);
		return scontrino.id.indexOf(id);
	}
    scontrino.unisciDuplicato = function (idx) {
        for (var i = 0; i < scontrino.id.length; ++i) {
            if (i != idx && scontrino.id[idx] == scontrino.id[i]) {
                scontrino.righe[i].quant += scontrino.righe[idx].quant;
                scontrino.elimina(idx);
                return i;
            }
        }
        return -1;
    }
	scontrino.invia = function () {
        scontrino.id.length = 0;
    }

</script>


<script type="text/javascript">





var reparti = [];
reparti.push({reparto: "BAR", col: "colore_caffe", prezzi: [
{desc: "BAR", prezzo: ""},
{desc: "Brioches", prezzo: "1,00"},
{desc: "Caffè Espresso", prezzo: "0,90"},
{desc: "Caffè Corretto", prezzo: "1,30"},
{desc: "Caffè Decaffeinato", prezzo: "1,00"},
{desc: "Caffè Freddo", prezzo: "1,60"},
{desc: "Caffè Ginseng Espresso", prezzo: "1,50"},
{desc: "Caffè Marocchino", prezzo: "1,50"},
{desc: "Caffè Shakerato", prezzo: "2,00"},
{desc: "Caffè Shakerato Corretto", prezzo: "2,50"},
{desc: "Cappuccino", prezzo: "1,20"},
{desc: "Cappuccino Orzo / Deca", prezzo: "1,30"},
{desc: "Latte bianco", prezzo: "1,00"},
{desc: "Latte macchiato", prezzo: "1,30"},
{desc: "Latte macchiato orzo/deca", prezzo: "1,40"},
{desc: "Orzo espresso", prezzo: "1,00"},
{desc: "Orzo in tazza grande", prezzo: "1,30"},
] });
reparti.push({reparto: "BEVANDE", col: "colore_bevande", prezzi: [
{desc: "Bibite alla spina 25 cl.", prezzo: "1,70"},
{desc: "Bibite alla spina 40 cl.", prezzo: "2,10"},
{desc: "Bibite alla spina 50 cl.", prezzo: "2,50"},
{desc: "Bott. Acqua 0,5 L.", prezzo: "1,00"},
{desc: "Bott. Acqua 1,5 L.", prezzo: "1,80"},
{desc: "Cedrata / Schweppes / Tonica", prezzo: "1,80"},
{desc: "Esta The", prezzo: "1,20"},
{desc: "Gatorade / Powerade", prezzo: "2,40"},
{desc: "Lattine 33 cl.", prezzo: "1,80"},
{desc: "Redbull / Burn", prezzo: "2,80"},
{desc: "Spremuta di agrumi", prezzo: "2,50"},
{desc: "Succhi di frutta 200 ml.", prezzo: "1,80"},
{desc: "Tè e infusi (da filtro)", prezzo: "1,30"},
{desc: "Tè freddo Bott. 0,5 L.", prezzo: "2,00"},
] });
reparti.push({reparto: "SNACKS", col: "colore_panini", prezzi: [
{desc: "Tramezzini", prezzo: "2,00"},
{desc: "Piadine, Maxi Toast", prezzo: "3,50"},
{desc: "Panini", prezzo: "3,50"},
{desc: "Crostini", prezzo: "1,50"},
{desc: "Pizza Bianca", prezzo: "1,0"},
{desc: "Pizza Farcita", prezzo: "1,50"},
{desc: "Pizza Margherita", prezzo: "1,20"},
] });
reparti.push({reparto: "CUCINA", col: "colore_cucina", prezzi: [
{desc: "CAFFE", prezzo: "1,10"},
{desc: "COCA", prezzo: "2,00"}
] });
reparti.push({reparto: "DESSERT", col: "colore_dessert", prezzi: [
{desc: "Gelato sfuso piccolo", prezzo: "2,00"},
{desc: "Gelato sfuso grande", prezzo: "3,00"},
{desc: "Granite", prezzo: "2,00"},
] });
reparti.push({reparto: "ALCOLICI", col: "colore_vini", prezzi: [
{desc: "Birra Becks spina 20 cl.", prezzo: "2,20"},
{desc: "Birra Becks spina 40 cl.", prezzo: "3,20"},
{desc: "Beck's 33 cl. / Moretti 33 cl.", prezzo: "2,70"},
{desc: "Becks 66 cl. / Moretti 66 cl.", prezzo: "3,70"},
{desc: "Ceres Strong 33 cl.", prezzo: "3,30"},
{desc: "Corona / Tennents 33 cl.", prezzo: "3,30"},
{desc: "Hoagarden 33 cl.", prezzo: "3,30"},
{desc: "Nastro Azzurro 33 cl.", prezzo: "3,30"},
{desc: "Calice vino", prezzo: "2,00"},
{desc: "Calice porto", prezzo: "2,50"},
{desc: "Calice prosecco / spumante", prezzo: "2,50"},
{desc: "Liquori nazionali", prezzo: "2,30"},
{desc: "Liquori esteri", prezzo: "2,80"},
{desc: "Brandy (Stravecchio)", prezzo: "2,80"},
{desc: "Cognacs", prezzo: "2,80"},
{desc: "Crema di Whisky", prezzo: "3,00"},
{desc: "Gin / Rhum / Tequila", prezzo: "3,00"},
{desc: "Grappa", prezzo: "2,50"},
{desc: "Grappa Prime Uve", prezzo: "3,00"},
{desc: "Limoncello", prezzo: "2,00"},
{desc: "Vermouth (Martini, Cinzano)", prezzo: "2,80"},
{desc: "Vodka", prezzo: "3,00"},
{desc: "Whisky", prezzo: "2,80"},
{desc: "Whisky invecchiati", prezzo: "3,30"}
] });
reparti.push({reparto: "VARIE", col: "colore_vini", prezzi: [
{desc: "Caramelle", prezzo: "3,00"},
{desc: "Chewing gum", prezzo: "2,00"},
] });



		</script>
	</body>
</html>
